#!/bin/bash

if [ ! -d "output" ]; then
    mkdir output
fi
if [ ! -d "output_yaml" ]; then
    mkdir output_yaml
fi

/bin/rm -rf output/*
/bin/rm -rf output_yaml/*

time ../bin/demo1 || exit
time ../bin/galsim_yaml demo1.yaml || exit

time ../bin/demo2 || exit
time ../bin/galsim_yaml demo2.yaml || exit

time ../bin/demo3 || exit
time ../bin/galsim_yaml demo3.yaml || exit

time ../bin/demo4 || exit
time ../bin/galsim_yaml demo4.yaml || exit

time ../bin/demo5 || exit
time ../bin/galsim_yaml demo5.yaml || exit

time ../bin/demo6 || exit
time ../bin/galsim_yaml demo6.yaml || exit

time ../bin/demo7 || exit
time ../bin/galsim_yaml demo7.yaml || exit

time ../bin/demo8 || exit
time ../bin/galsim_yaml demo8.yaml || exit

time ../bin/demo9 || echo "Sorry, sciPy required for running demo9"
time ../bin/galsim_yaml demo9.yaml || echo "Sorry, sciPy required for running demo9"

time ../bin/demo10 || exit
time ../bin/galsim_yaml demo10.yaml || exit

echo 'Checking diffs: (No output means success)'

# demo1:
# Don't check demo1, since it doesn't use a deterministic seed.
# If you add an initial seed in both places, then you can uncomment 
# the next line and it should work.
#diff output/demo1.fits output_yaml/demo1.fits 

# demo2:
diff output/demo2.fits output_yaml/demo2.fits 

# demo3:
diff output/demo3.fits output_yaml/demo3.fits 
diff output/demo3_epsf.fits output_yaml/demo3_epsf.fits 

# demo4:
diff output/multi.fits output_yaml/multi.fits 

# demo5:
diff output/g08_psf.fits output_yaml/g08_psf.fits
diff output/g08_gal.fits output_yaml/g08_gal.fits

# demo6:
diff output/psf_real.fits output_yaml/psf_real.fits
diff output/cube_real.fits output_yaml/cube_real.fits 

# demo7:
diff output/cube_phot.fits output_yaml/cube_phot.fits 

# demo8:
diff output/bpd_single.fits output_yaml/bpd_single.fits 
diff output/bpd_multi.fits output_yaml/bpd_multi.fits 

# demo9:
for dir_num in {1..4} 
do
    for file_num in {1..5}
    do
        file_name=nfw$dir_num/cluster000$file_num.fits
	diff output/$file_name output_yaml/$file_name
    done
done

# demo10:
diff output/power_spectrum.fits output_yaml/power_spectrum.fits 

