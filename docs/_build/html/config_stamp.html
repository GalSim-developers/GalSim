

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Config Stamp Field &mdash; GalSim 2.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Config Image Field" href="config_image.html" />
    <link rel="prev" title="Config Objects" href="config_objects.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> GalSim
          

          
          </a>

          
            
            
              <div class="version">
                2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">Images and Related Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="sb.html">Surface Brightness Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="wcs.html">World Coordinate Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="random.html">Noise and Random Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="chromatic.html">Wavelength-dependent Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="wl.html">Weak Lensing</a></li>
<li class="toctree-l1"><a class="reference internal" href="photon.html">Photon Shooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="coord.html">Angles and Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Helper Functions and Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Errors and Warnings</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="config.html">The Config Module</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="config_top.html">Top Level Fields</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="config_objects.html">Config Objects</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Config Stamp Field</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stamp-field-attributes">Stamp Field Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stamp-types">Stamp Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-stamp-types">Custom Stamp Types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="config_image.html">Config Image Field</a></li>
<li class="toctree-l3"><a class="reference internal" href="config_input.html">Config Input Field</a></li>
<li class="toctree-l3"><a class="reference internal" href="config_output.html">Config Output Field</a></li>
<li class="toctree-l3"><a class="reference internal" href="config_values.html">Config Values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="config_special.html">Special Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="config_galsim.html">The galsim Executable</a></li>
<li class="toctree-l2"><a class="reference internal" href="config_process.html">Config Processing From Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hsm.html">The HSM Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="des.html">The DES Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="wfirst.html">The WFIRST Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="shared.html">Shared Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Revision History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GalSim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="config.html">The Config Module</a> &raquo;</li>
        
          <li><a href="config_top.html">Top Level Fields</a> &raquo;</li>
        
      <li>Config Stamp Field</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/config_stamp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="config-stamp-field">
<h1>Config Stamp Field<a class="headerlink" href="#config-stamp-field" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">stamp</span></code> field defines some properties about how to draw the postage-stamp images of each
object.  It is often unneccessary to explicitly include this top-level field.  The default
<code class="docutils literal notranslate"><span class="pre">stamp</span></code> type, called ‘Basic’, is often what you want.</p>
<div class="section" id="stamp-field-attributes">
<h2>Stamp Field Attributes<a class="headerlink" href="#stamp-field-attributes" title="Permalink to this headline">¶</a></h2>
<p>Some attributes that are allowed for all stamp types are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">draw_method</span></code> = <em>str_value</em> (default = ‘auto’)  Valid options are:</p>
<blockquote>
<div><ul>
<li><p>‘auto’  The default is normally equivalent to ‘fft’.  However, if the object being rendered is simple (no convolution) and has hard edges (e.g. a Box or a truncated Moffat or Sersic), then it will switch to ‘real_space’, since that is often both faster and more accurate in these cases (due to ringing in Fourier space).</p></li>
<li><p>‘fft’  This method will convolve by the pixel (as well as convolving the galaxy and PSF if you have both) using a fast Fourier transform.</p></li>
<li><p>‘real_space’  This uses real-space integration to integrate over the pixel. This is only possible if there is only _either_ a PSF or galaxy, not both.  Also, it cannot involve a Convolution internally.  If GalSim is unable to do the real-space integration, this will revert to ‘fft’.</p></li>
<li><p>‘phot’  Use photon shooting, which treats the profile as a probability distribution, draws photons from that distribution, and then “shoots” them at the image.  The flux of each photon is added to whichever pixel it hits.  This automatically handles the integration over the pixel, but it cannot be used with Deconvolutions (including RealGalaxy objects) and the result will necessarily have Poisson noise from the finite number of photons being shot.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_extra_noise</span></code> = <em>float_value</em> (optional)  If the image is sky noise dominated, then it is efficient to stop shooting photons when the photon noise of the galaxy is much less than the sky noise. This parameter specifies how much extra noise, as a fraction of the sky noise, is permissible in any pixel.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_photons</span></code> = <em>int_value</em> (optional; default is to assume the object flux is given in photons and use that) Specifies the total number of photons to shoot as a hard, fixed number.  If both <code class="docutils literal notranslate"><span class="pre">n_photons</span></code> and <code class="docutils literal notranslate"><span class="pre">max_extra_noise</span></code> are specified in the options, <code class="docutils literal notranslate"><span class="pre">max_extra_noise</span></code> is ignored and a warning is generated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">poisson_flux</span></code> = <em>bool_value</em> (default = True, unless <code class="docutils literal notranslate"><span class="pre">n_photons</span></code> is given, in which case the default is False) Whether to allow the total object flux to vary according to Poisson statistics for the number of photons being shot.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>‘no_pixel’  This will not integrate the flux over the pixel response.  Rather, it just samples the surface brightness distribution at the pixel centers and multiplies by the pixel area.  This is appropriate if the PSF already has the pixel response included (e.g. from an observed image of a PSF).</p></li>
<li><p>‘sb’  This is similar to ‘no_pixel’, except that the image values will simply be the sampled surface brightness, not multiplied by the pixel area.  This does not correspond to any real observing scenario, but it could be useful if you want to view the surface brightness profile of an object directly, without including the pixel integration.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">offset</span></code> = <em>pos_value</em> (optional) An offset in chip coordinates (i.e. pixel units) to apply when drawing the object on the postage stamp.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gsparams</span></code> = <em>dict</em> (optional) A dict of (non-default) GSParams items that you want applied to the constructed object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">retry_failures</span></code> = <em>int_value</em> (default = 0) How many times to retry the construction of a GSObject if there is any kind of failure.  For example, you might have a random shear value that technically may come back with <span class="math notranslate nohighlight">\(|g| &gt; 1\)</span>, but it should be very rare.  So you might set it to retry once or twice in that case.  If this is &gt; 0, then after a failure, the code will wait 1 second (in case the failure was related to memory usage on the machine), and then try again up to this many times.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">world_pos</span></code> = <em>pos_value</em> or <em>sky_value</em> (only one of <code class="docutils literal notranslate"><span class="pre">world_pos</span></code> and <code class="docutils literal notranslate"><span class="pre">image_pos</span></code> is allowed) The position in world coordinates at which to center the object.  This is often defined in the <code class="docutils literal notranslate"><span class="pre">image</span></code> field, but it can be overridden in the <code class="docutils literal notranslate"><span class="pre">stamp</span></code> field.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image_pos</span></code> = <em>pos_value</em> (only one of <code class="docutils literal notranslate"><span class="pre">world_pos</span></code> and <code class="docutils literal notranslate"><span class="pre">image_pos</span></code> is allowed) The position on the full image at which to center the object.  This is often defined in the <code class="docutils literal notranslate"><span class="pre">image</span></code> field, but it can be overridden in the <code class="docutils literal notranslate"><span class="pre">stamp</span></code> field.  Note: the object is always centered as nearly as possible on the postage stamp being drawn (unless an explicit <code class="docutils literal notranslate"><span class="pre">offset</span></code> is given), but the <code class="docutils literal notranslate"><span class="pre">image_pos</span></code> or <code class="docutils literal notranslate"><span class="pre">world_pos</span></code> determines where in the larger image this stamp is placed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skip</span></code> = <em>bool_value</em> (default=False)  Skip this stamp.</p></li>
</ul>
</div>
<div class="section" id="stamp-types">
<h2>Stamp Types<a class="headerlink" href="#stamp-types" title="Permalink to this headline">¶</a></h2>
<p>The default stamp type is ‘Basic’, which constructs a galaxy object based on the <code class="docutils literal notranslate"><span class="pre">gal</span></code> field
(if present) and a PSF object from the <code class="docutils literal notranslate"><span class="pre">psf</span></code> field (again, if present), convolves them
together, and draws the object onto a postage stamp.  This is often what you need, but
there is also a ‘Ring’ type, and you can define your own custom <code class="docutils literal notranslate"><span class="pre">stamp</span></code> type if you want
to customize any aspect of the stamp-building process.</p>
<ul>
<li><p>‘Basic’ The postage stamp contains a single <code class="docutils literal notranslate"><span class="pre">gal</span></code> object convolved by a <code class="docutils literal notranslate"><span class="pre">psf</span></code> object, assuming both fields are given.  If only one of the two is given, that one is drawn.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code> = <em>int_value</em> (optional)  If you want square postage stamps for each object (common), you just need to set this one value and the images will be <code class="docutils literal notranslate"><span class="pre">size</span></code> x <code class="docutils literal notranslate"><span class="pre">size</span></code>. The default is for GalSim to automatically determine a good size for the image that will encompass most of the flux of the object, but note that the <code class="docutils literal notranslate"><span class="pre">image</span></code> type may define the stamp size (e.g. ‘Tiled’), in which case that will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xsize</span></code> = <em>int_value</em> (default = <code class="docutils literal notranslate"><span class="pre">size</span></code>)  If you want non-square postage stamps, you can specify <code class="docutils literal notranslate"><span class="pre">xsize</span></code> and <code class="docutils literal notranslate"><span class="pre">ysize</span></code> separately instead. It is an error for only one of them to be non-zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ysize</span></code> = <em>int_value</em> (default = <code class="docutils literal notranslate"><span class="pre">size</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_flux_frac</span></code> = <em>float_value</em> (optional) If the rendered stamp (before noise is applied) has less than this fraction of the nominal flux of the object, reject it and start over (presumably choosing new random values for size, flux, etc.).  This counts as a “failure” for the purpose of the <code class="docutils literal notranslate"><span class="pre">retry_failures</span></code> count.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_snr</span></code> = <em>float_value</em> (optional) If the measured signal-to-noise ratio (using the optimal matched filter definition of S/N, measured using the signal on the stamp before noise is applied) is less than this, then reject it and start over.  This counts as a “failure” for the purpose of the <code class="docutils literal notranslate"><span class="pre">retry_failures</span></code> count.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_snr</span></code> = <em>float_value</em> (optional) If the measured signal-to-noise ratio is higher than this, then reject it and start over.  This counts as a “failure” for the purpose of the <code class="docutils literal notranslate"><span class="pre">retry_failures</span></code> count.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reject</span></code> = <em>bool_value</em> (optional) If this evaluates to true, then reject the current stamp and start over.  Typically, this would be a custom function that would perform some measurement on the pre-noise image.
See <a class="reference download internal" download="" href="_downloads/f2b30d40a89c1c39718c2a64f0894b58/cgc.yaml"><code class="xref download docutils literal notranslate"><span class="pre">cgc.yaml</span></code></a> for an examples of such a custom function.  This counts as a “failure” for the purpose of the <code class="docutils literal notranslate"><span class="pre">retry_failures</span></code> count.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>‘Ring’ Generate galaxies in a ring for a ring test. (Use num=2 to get pairs of 90 degree rotated galaxies.)</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code>, <code class="docutils literal notranslate"><span class="pre">xsize</span></code>, <code class="docutils literal notranslate"><span class="pre">ysize</span></code> = <em>int_value</em> (optional) Same meaning as for ‘Basic’ type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num</span></code> = <em>int_value</em> (required)  How many objects to include in the ring.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">full_rotation</span></code> = <em>angle_value</em> (default = 180 degrees)  What angle should be spanned by the full rotation?  The default of 180 degrees is appropriate for the typical case of a rotationally symmetric galaxy (e.g. a sheared Exponential), but if the <code class="docutils literal notranslate"><span class="pre">first</span></code> profile does not have rotational symmetry, then you probably want to set this to 360 degrees.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code> = <em>int_value</em> (default = ‘Sequence’ from 0 to num-1)  Which item in the Ring is this.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_flux_frac</span></code> = <em>float_value</em> (optional) Equivalent to Basic, but only applies to the first stamp in the ring.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_snr</span></code> = <em>float_value</em> (optional) Equivalent to Basic, but only applies to the first stamp in the ring.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_snr</span></code> = <em>float_value</em> (optional) Equivalent to Basic, but only applies to the first stamp in the ring.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reject</span></code> = <em>bool_value</em> (optional) Equivalent to Basic, but only applies to the first stamp in the ring.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="custom-stamp-types">
<h2>Custom Stamp Types<a class="headerlink" href="#custom-stamp-types" title="Permalink to this headline">¶</a></h2>
<p>To define your own stamp type, you will need to write an importable Python module
(typically a file in the current directory where you are running <code class="docutils literal notranslate"><span class="pre">galsim</span></code>, but it could also
be something you have installed in your Python distro) with a class that will be used
to build the stamp.</p>
<p>The class should be a subclass of <a class="reference internal" href="#galsim.config.StampBuilder" title="galsim.config.StampBuilder"><code class="xref any py py-class docutils literal notranslate"><span class="pre">galsim.config.StampBuilder</span></code></a>, which is the class used for
the default ‘Basic’ type.  There are a number of class methods, and you only need to override
the ones for which you want different behavior than that of the ‘Basic’ type.</p>
<dl class="class">
<dt id="galsim.config.StampBuilder">
<em class="property">class </em><code class="sig-prename descclassname">galsim.config.</code><code class="sig-name descname">StampBuilder</code><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder" title="Permalink to this definition">¶</a></dt>
<dd><p>A base class for building stamp images of individual objects.</p>
<p>The base class defines the call signatures of the methods that any derived class should follow.
It also includes the implementation of the default stamp type: Basic.</p>
<dl class="method">
<dt id="galsim.config.StampBuilder.addNoise">
<code class="sig-name descname">addNoise</code><span class="sig-paren">(</span><em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">image</em>, <em class="sig-param">skip</em>, <em class="sig-param">current_var</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.addNoise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.addNoise" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the sky level and the noise to the stamp.</p>
<dl class="simple">
<dt>Note: This only gets called if the image type requests that the noise be added to each</dt><dd><p>stamp individually, rather than to the full image and the end.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>image</strong> – The current image.</p></li>
<li><p><strong>skip</strong> – Are we skipping this image? (Usually this is irrelevant, since we
need sky and noise regardless, but user-defined classes might choose
to do something different if skipping this object.)</p></li>
<li><p><strong>current_var</strong> – The current noise variance present in the image already.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the new values of image, current_var</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.applySNRScale">
<code class="sig-name descname">applySNRScale</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">prof</em>, <em class="sig-param">scale_factor</em>, <em class="sig-param">method</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.applySNRScale"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.applySNRScale" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the scale_factor from getSNRScale to the image and profile.</p>
<p>The default implementaion just multiplies each of them, but if prof is not a regular
GSObject, then you might need to do something different.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – The current image.</p></li>
<li><p><strong>prof</strong> – The profile that was drawn.</p></li>
<li><p><strong>scale_factor</strong> – The factor by which to scale both image and prof.</p></li>
<li><p><strong>method</strong> – The method used by drawImage.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>image, prof  (after being properly scaled)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.buildProfile">
<code class="sig-name descname">buildProfile</code><span class="sig-paren">(</span><em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">psf</em>, <em class="sig-param">gsparams</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.buildProfile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.buildProfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Build the surface brightness profile (a GSObject) to be drawn.</p>
<p>For the Basic stamp type, this builds a galaxy from the base[‘gal’] dict and convolves
it with the psf (if given).  If either the psf or the galaxy is None, then the other one
is returned as is.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>psf</strong> – The PSF, if any.  This may be None, in which case, no PSF is convolved.</p></li>
<li><p><strong>gsparams</strong> – A dict of kwargs to use for a GSParams.  More may be added to this
list by the galaxy object.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the final profile</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><em class="sig-param">prof</em>, <em class="sig-param">image</em>, <em class="sig-param">method</em>, <em class="sig-param">offset</em>, <em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.draw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw the profile on the postage stamp image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prof</strong> – The profile to draw.</p></li>
<li><p><strong>image</strong> – The image onto which to draw the profile (which may be None).</p></li>
<li><p><strong>method</strong> – The method to use in drawImage.</p></li>
<li><p><strong>offset</strong> – The offset to apply when drawing.</p></li>
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the resulting image</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.getSNRScale">
<code class="sig-name descname">getSNRScale</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.getSNRScale"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.getSNRScale" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the factor by which to rescale the image based on a desired S/N level.</p>
<dl class="simple">
<dt>Note: The default implementation does this for the gal or psf field, so if a custom</dt><dd><p>stamp builder uses some other way to get the profiles, this method should
probably be overridden.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – The current image.</p></li>
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>scale_factor</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.makeStamp">
<code class="sig-name descname">makeStamp</code><span class="sig-paren">(</span><em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">xsize</em>, <em class="sig-param">ysize</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.makeStamp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.makeStamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Make the initial empty postage stamp image, if possible.</p>
<p>If we don’t know xsize, ysize, return None, in which case the stamp will be created
automatically by the drawImage command based on the natural size of the profile.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>xsize</strong> – The xsize of the image to build (if known).</p></li>
<li><p><strong>ysize</strong> – The ysize of the image to build (if known).</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the image</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.makeTasks">
<code class="sig-name descname">makeTasks</code><span class="sig-paren">(</span><em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">jobs</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.makeTasks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.makeTasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn a list of jobs into a list of tasks.</p>
<p>For the Basic stamp type, there is just one job per task, so the tasks list is just:</p>
<blockquote>
<div><p>tasks = [ [ (job, k) ] for k, job in enumerate(jobs) ]</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>jobs</strong> – A list of jobs to split up into tasks.  Each job in the list is a
dict of parameters that includes ‘obj_num’.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a list of tasks</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.reject">
<code class="sig-name descname">reject</code><span class="sig-paren">(</span><em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">prof</em>, <em class="sig-param">psf</em>, <em class="sig-param">image</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.reject"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.reject" title="Permalink to this definition">¶</a></dt>
<dd><p>Check to see if this object should be rejected.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>prof</strong> – The profile that was drawn.</p></li>
<li><p><strong>psf</strong> – The psf that was used to build the profile.</p></li>
<li><p><strong>image</strong> – The postage stamp image.  No noise is on it yet at this point.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>whether to reject this object</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><em class="sig-param">base</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset some aspects of the config dict so the object can be rebuilt after rejecting the
current object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.setup">
<code class="sig-name descname">setup</code><span class="sig-paren">(</span><em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">xsize</em>, <em class="sig-param">ysize</em>, <em class="sig-param">ignore</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.setup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Do the initialization and setup for building a postage stamp.</p>
<p>In the base class, we check for and parse the appropriate size and position values in
config (aka base[‘stamp’] or base[‘image’].</p>
<p>Values given in base[‘stamp’] take precedence if these are given in both places (which
would be confusing, so probably shouldn’t do that, but there might be a use case where it
would make sense).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>xsize</strong> – The xsize of the image to build (if known).</p></li>
<li><p><strong>ysize</strong> – The ysize of the image to build (if known).</p></li>
<li><p><strong>ignore</strong> – A list of parameters that are allowed to be in config that we can
ignore here. i.e. it won’t be an error if these parameters are present.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>xsize, ysize, image_pos, world_pos</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.updateSkip">
<code class="sig-name descname">updateSkip</code><span class="sig-paren">(</span><em class="sig-param">prof</em>, <em class="sig-param">image</em>, <em class="sig-param">method</em>, <em class="sig-param">offset</em>, <em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.updateSkip"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.updateSkip" title="Permalink to this definition">¶</a></dt>
<dd><p>Before drawing the profile, see whether this object can be trivially skipped.</p>
<p>The base method checks if the object is completely off the main image, so the
intersection bounds will be undefined.  In this case, don’t bother drawing the
postage stamp for this object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prof</strong> – The profile to draw.</p></li>
<li><p><strong>image</strong> – The image onto which to draw the profile (which may be None).</p></li>
<li><p><strong>method</strong> – The method to use in drawImage.</p></li>
<li><p><strong>offset</strong> – The offset to apply when drawing.</p></li>
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>whether to skip drawing this object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.config.StampBuilder.whiten">
<code class="sig-name descname">whiten</code><span class="sig-paren">(</span><em class="sig-param">prof</em>, <em class="sig-param">image</em>, <em class="sig-param">config</em>, <em class="sig-param">base</em>, <em class="sig-param">logger</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/config/stamp.html#StampBuilder.whiten"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.StampBuilder.whiten" title="Permalink to this definition">¶</a></dt>
<dd><p>If appropriate, whiten the resulting image according to the requested noise profile
and the amount of noise originally present in the profile.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prof</strong> – The profile to draw.</p></li>
<li><p><strong>image</strong> – The image onto which to draw the profile.</p></li>
<li><p><strong>config</strong> – The configuration dict for the stamp field.</p></li>
<li><p><strong>base</strong> – The base configuration dict.</p></li>
<li><p><strong>logger</strong> – If given, a logger object to log progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the variance of the resulting whitened (or symmetrized) image.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">base</span></code> parameter is the original full configuration dict that is being used for running the
simulation.  The <code class="docutils literal notranslate"><span class="pre">config</span></code> parameter is the local portion of the full dict that defines the stamp
being built, which would typically be <code class="docutils literal notranslate"><span class="pre">base['stamp']</span></code>.</p>
<p>Then, in the Python module, you need to register this function with some type name, which will
be the value of the <code class="docutils literal notranslate"><span class="pre">type</span></code> attribute that triggers the use of this Builder object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">galsim</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">RegisterStampType</span><span class="p">(</span><span class="s1">&#39;CustomStamp&#39;</span><span class="p">,</span> <span class="n">CustomStampBuilder</span><span class="p">())</span>
</pre></div>
</div>
<p>Note that we register an instance of the class, not the class itself.  This opens up the
possibility of having multiple stamp types use the same class instantiated with different
initialization parameters.  This is not used by the GalSim stamp types, but there may be use
cases where it would be useful for custom stamp types.</p>
<p>Finally, to use this custom type in your config file, you need to tell the config parser the
name of the module to load at the start of processing.  e.g. if this function is defined in the
file <code class="docutils literal notranslate"><span class="pre">my_custom_stamp.py</span></code>, then you would use the following top-level <code class="docutils literal notranslate"><span class="pre">modules</span></code> field
in the config file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">modules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my_custom_stamp</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">modules</span></code> field is a list, so it can contain more than one module to load if you want.
Then before processing anything, the code will execute the command <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">my_custom_stamp</span></code>,
which will read your file and execute the registration command to add the buidler to the list
of valid stamp types.</p>
<p>Then you can use this as a valid stamp type:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">stamp</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CustomStamp</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>For examples of custom stamps, see</p>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="_downloads/c8d126e301f128ca2b7061ad207cb667/blend.yaml"><code class="xref download docutils literal notranslate"><span class="pre">blend.yaml</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="_downloads/c89d2f3d39fb6d561511338ec27c7757/blendset.yaml"><code class="xref download docutils literal notranslate"><span class="pre">blendset.yaml</span></code></a></p></li>
</ul>
<p>which use custom stamp types <code class="docutils literal notranslate"><span class="pre">Blend</span></code> and <code class="docutils literal notranslate"><span class="pre">BlendSet</span></code> defined in <a class="reference download internal" download="" href="_downloads/8914d4e6ad794a54b9481831181ea910/blend.py"><code class="xref download docutils literal notranslate"><span class="pre">blend.py</span></code></a>.</p>
<p>It may also be helpful to look at the GalSim implementation of the include <code class="docutils literal notranslate"><span class="pre">Ring</span></code> type:
(click on the <code class="docutils literal notranslate"><span class="pre">[source]</span></code> link):</p>
<dl class="class">
<dt id="galsim.config.stamp_ring.RingBuilder">
<em class="property">class </em><code class="sig-prename descclassname">galsim.config.stamp_ring.</code><code class="sig-name descname">RingBuilder</code><a class="reference internal" href="_modules/galsim/config/stamp_ring.html#RingBuilder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.config.stamp_ring.RingBuilder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">galsim.config.stamp.StampBuilder</span></code></p>
<p>This performs the tasks necessary for building a Ring stamp type.</p>
<p>It uses the regular Basic functions for most things.
It specializes the setup, buildProfile, reject, and makeTasks functions.</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="config_image.html" class="btn btn-neutral float-right" title="Config Image Field" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="config_objects.html" class="btn btn-neutral float-left" title="Config Objects" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, GalSim-developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>