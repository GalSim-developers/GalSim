<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The HSM Module &mdash; GalSim 2.3.5 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The DES Module" href="des.html" />
    <link rel="prev" title="Config Processing From Python" href="config_process.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> GalSim
          </a>
              <div class="version">
                2.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">Images and Related Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="sb.html">Surface Brightness Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="chromatic.html">Wavelength-dependent Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="wcs.html">World Coordinate Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="random.html">Noise and Random Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="wl.html">Weak Lensing</a></li>
<li class="toctree-l1"><a class="reference internal" href="photon.html">Photon Shooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Helper Functions and Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Errors and Warnings</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">The Config Module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The HSM Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#shape-measurement-functions">Shape Measurement Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hsm-output">HSM output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hsm-parameters">HSM parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="des.html">The DES Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="roman.html">The Roman Space Telescope Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="shared.html">Shared Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Revision History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GalSim</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>The HSM Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/hsm.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="the-hsm-module">
<h1>The HSM Module<a class="headerlink" href="#the-hsm-module" title="Permalink to this headline">¶</a></h1>
<p>Routines for adaptive moment estimation and PSF correction.</p>
<p>This module contains code for estimation of second moments of images, and for carrying out PSF
correction using a variety of algorithms.  The algorithms are described in
<a class="reference external" href="http://adsabs.harvard.edu/abs/2003MNRAS.343..459H">Hirata &amp; Seljak (2003)</a>, and were
tested/characterized using real data in
<a class="reference external" href="http://adsabs.harvard.edu/abs/2005MNRAS.361.1287M">Mandelbaum et al. (2005)</a>.
Note that these routines for moment measurement and shear estimation are not accessible via config,
only via python.  There are a number of default settings for the code (often governing the tradeoff
between accuracy and speed) that can be adjusting using an optional <code class="docutils literal notranslate"><span class="pre">hsmparams</span></code> argument as
described below.</p>
<p>The moments that are estimated are “adaptive moments” (see the first paper cited above for details);
that is, they use an elliptical Gaussian weight that is matched to the image of the object being
measured.  The observed moments can be represented as a Gaussian sigma and a Shear object
representing the shape.</p>
<p>The PSF correction includes several algorithms, three that are re-implementations of methods
originated by others and one that was originated by Hirata &amp; Seljak:</p>
<ul class="simple">
<li><p>One from <a class="reference external" href="http://adsabs.harvard.edu/abs/1995ApJ...449..460K">Kaiser, Squires, &amp; Broadhurst (1995)</a>, “KSB”</p></li>
<li><p>One from <a class="reference external" href="http://adsabs.harvard.edu/abs/2002AJ....123..583B">Bernstein &amp; Jarvis (2002)</a>, “BJ”</p></li>
<li><p>One that represents a modification by Hirata &amp; Seljak (2003) of methods in Bernstein &amp; Jarvis (2002), “LINEAR”</p></li>
<li><p>One method from Hirata &amp; Seljak (2003), “REGAUSS” (re-Gaussianization)</p></li>
</ul>
<p>These methods return shear (or shape) estimators, which may not in fact satisfy conditions like
<span class="math notranslate nohighlight">\(|e|&lt;=1\)</span>, and so they are represented simply as e1/e2 or g1/g2 (depending on the method)
rather than using a Shear object, which IS required to satisfy <span class="math notranslate nohighlight">\(|e|&lt;=1\)</span>.</p>
<p>These methods are all based on correction of moments, but with different sets of assumptions.  For
more detailed discussion on all of these algorithms, see the relevant papers above.</p>
<p>Users can find a listing of the parameters that can be adjusted using the <code class="docutils literal notranslate"><span class="pre">hsmparams</span></code> keyword,
along with default values, under <a class="reference internal" href="#galsim.hsm.HSMParams" title="galsim.hsm.HSMParams"><code class="xref any py py-class docutils literal notranslate"><span class="pre">galsim.hsm.HSMParams</span></code></a> below.</p>
<div class="section" id="shape-measurement-functions">
<h2>Shape Measurement Functions<a class="headerlink" href="#shape-measurement-functions" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="galsim.hsm.FindAdaptiveMom">
<code class="sig-prename descclassname"><span class="pre">galsim.hsm.</span></code><code class="sig-name descname"><span class="pre">FindAdaptiveMom</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">badpix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">guess_sig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">guess_centroid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">round_moments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hsmparams</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/hsm.html#FindAdaptiveMom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#galsim.hsm.FindAdaptiveMom" title="Permalink to this definition">¶</a></dt>
<dd><p>Measure adaptive moments of an object.</p>
<p>This method estimates the best-fit elliptical Gaussian to the object (see Hirata &amp; Seljak 2003
for more discussion of adaptive moments).  This elliptical Gaussian is computed iteratively
by initially guessing a circular Gaussian that is used as a weight function, computing the
weighted moments, recomputing the moments using the result of the previous step as the weight
function, and so on until the moments that are measured are the same as those used for the
weight function.  <a class="reference internal" href="#galsim.hsm.FindAdaptiveMom" title="galsim.hsm.FindAdaptiveMom"><code class="xref any py py-func docutils literal notranslate"><span class="pre">FindAdaptiveMom</span></code></a> can be used either as a free function, or as a method of the
<a class="reference internal" href="image_class.html#galsim.Image" title="galsim.Image"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Image</span></code></a> class.</p>
<p>This routine assumes that (at least locally) the WCS can be approximated as a <a class="reference internal" href="wcs.html#galsim.PixelScale" title="galsim.PixelScale"><code class="xref any py py-class docutils literal notranslate"><span class="pre">PixelScale</span></code></a>, with
no distortion or non-trivial remapping. Any non-trivial WCS gets completely ignored.</p>
<p>Like <a class="reference internal" href="#galsim.hsm.EstimateShear" title="galsim.hsm.EstimateShear"><code class="xref any py py-func docutils literal notranslate"><span class="pre">EstimateShear</span></code></a>, <a class="reference internal" href="#galsim.hsm.FindAdaptiveMom" title="galsim.hsm.FindAdaptiveMom"><code class="xref any py py-func docutils literal notranslate"><span class="pre">FindAdaptiveMom</span></code></a> works on <a class="reference internal" href="image_class.html#galsim.Image" title="galsim.Image"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Image</span></code></a> inputs, and fails if the object is
small compared to the pixel scale.  For more details, see <a class="reference internal" href="#galsim.hsm.EstimateShear" title="galsim.hsm.EstimateShear"><code class="xref any py py-func docutils literal notranslate"><span class="pre">EstimateShear</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">my_gaussian</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">flux</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_gaussian_image</span> <span class="o">=</span> <span class="n">my_gaussian</span><span class="o">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;no_pixel&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_moments</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">hsm</span><span class="o">.</span><span class="n">FindAdaptiveMom</span><span class="p">(</span><span class="n">my_gaussian_image</span><span class="p">)</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">my_moments</span> <span class="o">=</span> <span class="n">my_gaussian_image</span><span class="o">.</span><span class="n">FindAdaptiveMom</span><span class="p">()</span>
</pre></div>
</div>
<p>Assuming a successful measurement, the most relevant pieces of information are
<code class="docutils literal notranslate"><span class="pre">my_moments.moments_sigma</span></code>, which is <code class="docutils literal notranslate"><span class="pre">|det(M)|^(1/4)</span></code> (= <code class="docutils literal notranslate"><span class="pre">sigma</span></code> for a circular Gaussian)
and <code class="docutils literal notranslate"><span class="pre">my_moments.observed_shape</span></code>, which is a <a class="reference internal" href="shear.html#galsim.Shear" title="galsim.Shear"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shear</span></code></a>.  In this case,
<code class="docutils literal notranslate"><span class="pre">my_moments.moments_sigma</span></code> is precisely 5.0 (in units of pixels), and
<code class="docutils literal notranslate"><span class="pre">my_moments.observed_shape</span></code> is consistent with zero.</p>
<p>Methods of the <a class="reference internal" href="shear.html#galsim.Shear" title="galsim.Shear"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shear</span></code></a> class can be used to get the distortion <code class="docutils literal notranslate"><span class="pre">e</span></code>, the shear <code class="docutils literal notranslate"><span class="pre">g</span></code>, the
conformal shear <code class="docutils literal notranslate"><span class="pre">eta</span></code>, and so on.</p>
<p>As an example of how to use the optional <code class="docutils literal notranslate"><span class="pre">hsmparams</span></code> argument, consider cases where the input
images have unusual properties, such as being very large.  This could occur when measuring the
properties of a very over-sampled image such as that generated using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">my_gaussian</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_gaussian_image</span> <span class="o">=</span> <span class="n">my_gaussian</span><span class="o">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;no_pixel&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the user attempts to measure the moments of this very large image using the standard syntax,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">my_moments</span> <span class="o">=</span> <span class="n">my_gaussian_image</span><span class="o">.</span><span class="n">FindAdaptiveMom</span><span class="p">()</span>
</pre></div>
</div>
<p>then the result will be a <code class="docutils literal notranslate"><span class="pre">GalSimHSMError</span></code> due to moment measurement failing because the
object is so large.  While the list of all possible settings that can be changed is accessible
in the docstring of the <a class="reference internal" href="#galsim.hsm.HSMParams" title="galsim.hsm.HSMParams"><code class="xref any py py-class docutils literal notranslate"><span class="pre">HSMParams</span></code></a> class, in this case we need to modify <code class="docutils literal notranslate"><span class="pre">max_amoment</span></code> which
is the maximum value of the moments in units of pixel^2.  The following measurement, using the
default values for every parameter except for <code class="docutils literal notranslate"><span class="pre">max_amoment</span></code>, will be
successful:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_params</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">hsm</span><span class="o">.</span><span class="n">HSMParams</span><span class="p">(</span><span class="n">max_amoment</span><span class="o">=</span><span class="mf">5.0e5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_moments</span> <span class="o">=</span> <span class="n">my_gaussian_image</span><span class="o">.</span><span class="n">FindAdaptiveMom</span><span class="p">(</span><span class="n">hsmparams</span><span class="o">=</span><span class="n">new_params</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object_image</strong> – The <a class="reference internal" href="image_class.html#galsim.Image" title="galsim.Image"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Image</span></code></a> for the object being measured.</p></li>
<li><p><strong>weight</strong> – The optional weight image for the object being measured.  Can be an int
or a float array.  Currently, GalSim does not account for the variation
in non-zero weights, i.e., a weight map is converted to an image with 0
and 1 for pixels that are not and are used.  Full use of spatial
variation in non-zero weights will be included in a future version of
the code. [default: None]</p></li>
<li><p><strong>badpix</strong> – The optional bad pixel mask for the image being used.  Zero should be
used for pixels that are good, and any nonzero value indicates a bad
pixel. [default: None]</p></li>
<li><p><strong>guess_sig</strong> – Optional argument with an initial guess for the Gaussian sigma of the
object (in pixels). [default: 5.0]</p></li>
<li><p><strong>precision</strong> – The convergence criterion for the moments. [default: 1e-6]</p></li>
<li><p><strong>guess_centroid</strong> – An initial guess for the object centroid (useful in case it is not
located at the center, which is used if this keyword is not set).  The
convention for centroids is such that the center of the lower-left pixel
is (image.xmin, image.ymin).
[default: object_image.true_center]</p></li>
<li><p><strong>strict</strong> – Whether to require success. If <code class="docutils literal notranslate"><span class="pre">strict=True</span></code>, then there will be a
<code class="docutils literal notranslate"><span class="pre">GalSimHSMError</span></code> exception if shear estimation fails.  If set to
<code class="docutils literal notranslate"><span class="pre">False</span></code>, then information about failures will be silently stored in
the output ShapeData object. [default: True]</p></li>
<li><p><strong>round_moments</strong> – Use a circular weight function instead of elliptical.
[default: False]</p></li>
<li><p><strong>hsmparams</strong> – The hsmparams keyword can be used to change the settings used by
FindAdaptiveMom when estimating moments; see <a class="reference internal" href="#galsim.hsm.HSMParams" title="galsim.hsm.HSMParams"><code class="xref any py py-class docutils literal notranslate"><span class="pre">HSMParams</span></code></a> documentation
for more information. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#galsim.hsm.ShapeData" title="galsim.hsm.ShapeData"><code class="xref any py py-class docutils literal notranslate"><span class="pre">ShapeData</span></code></a> object containing the results of moment measurement.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="galsim.hsm.EstimateShear">
<code class="sig-prename descclassname"><span class="pre">galsim.hsm.</span></code><code class="sig-name descname"><span class="pre">EstimateShear</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gal_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">PSF_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">badpix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sky_var</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear_est</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'REGAUSS'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recompute_flux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'FIT'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">guess_sig_gal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">guess_sig_PSF</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">guess_centroid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hsmparams</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/hsm.html#EstimateShear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#galsim.hsm.EstimateShear" title="Permalink to this definition">¶</a></dt>
<dd><p>Carry out moments-based PSF correction routines.</p>
<p>Carry out PSF correction using one of the methods of the HSM package (see references in
docstring for file hsm.py) to estimate galaxy shears, correcting for the convolution by the
PSF.</p>
<p>This method works from <a class="reference internal" href="image_class.html#galsim.Image" title="galsim.Image"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Image</span></code></a> inputs rather than <a class="reference internal" href="gsobject.html#galsim.GSObject" title="galsim.GSObject"><code class="xref any py py-class docutils literal notranslate"><span class="pre">GSObject</span></code></a> inputs, which provides
additional flexibility (e.g., it is possible to work from an <a class="reference internal" href="image_class.html#galsim.Image" title="galsim.Image"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Image</span></code></a> that was read from file and
corresponds to no particular <a class="reference internal" href="gsobject.html#galsim.GSObject" title="galsim.GSObject"><code class="xref any py py-class docutils literal notranslate"><span class="pre">GSObject</span></code></a>), but this also means that users who wish to apply it to
compount <a class="reference internal" href="gsobject.html#galsim.GSObject" title="galsim.GSObject"><code class="xref any py py-class docutils literal notranslate"><span class="pre">GSObject</span></code></a> classes (e.g., <a class="reference internal" href="composite.html#galsim.Convolve" title="galsim.Convolve"><code class="xref any py py-func docutils literal notranslate"><span class="pre">Convolve</span></code></a>) must take the additional step of drawing
their <a class="reference internal" href="gsobject.html#galsim.GSObject" title="galsim.GSObject"><code class="xref any py py-class docutils literal notranslate"><span class="pre">GSObject</span></code></a> into <a class="reference internal" href="image_class.html#galsim.Image" title="galsim.Image"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Image</span></code></a> instances.</p>
<p>This routine assumes that (at least locally) the WCS can be approximated as a <a class="reference internal" href="wcs.html#galsim.PixelScale" title="galsim.PixelScale"><code class="xref any py py-class docutils literal notranslate"><span class="pre">PixelScale</span></code></a>, with
no distortion or non-trivial remapping. Any non-trivial WCS gets completely ignored.</p>
<p>Note that the method will fail if the PSF or galaxy are too point-like to easily fit an
elliptical Gaussian; when running on batches of many galaxies, it may be preferable to set
<code class="docutils literal notranslate"><span class="pre">strict=False</span></code> and catch errors explicitly, as in the second example below.</p>
<p>This function has a number of keyword parameters, many of which a typical user will not need to
change from the default.</p>
<p>Example:</p>
<p>Typical application to a single object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">flux</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">galaxy</span> <span class="o">=</span> <span class="n">galaxy</span><span class="o">.</span><span class="n">shear</span><span class="p">(</span><span class="n">g1</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">g2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># shears the Gaussian by (0.05, 0) using the</span>
<span class="gp">&gt;&gt;&gt; </span>                                        <span class="c1"># |g| = (a-b)/(a+b) definition</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">Kolmogorov</span><span class="p">(</span><span class="n">flux</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">final</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">Convolve</span><span class="p">(</span><span class="n">galaxy</span><span class="p">,</span> <span class="n">psf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">final_image</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">final_epsf_image</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">hsm</span><span class="o">.</span><span class="n">EstimateShear</span><span class="p">(</span><span class="n">final_image</span><span class="p">,</span> <span class="n">final_epsf_image</span><span class="p">)</span>
</pre></div>
</div>
<p>After running the above code, <code class="docutils literal notranslate"><span class="pre">result.observed_shape</span></code> is a <a class="reference internal" href="shear.html#galsim.Shear" title="galsim.Shear"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shear</span></code></a> object with a value of
<code class="docutils literal notranslate"><span class="pre">(0.0438925349133,</span> <span class="pre">-2.85747392701e-18)</span></code> and <code class="docutils literal notranslate"><span class="pre">result.corrected_e1</span></code>, <code class="docutils literal notranslate"><span class="pre">result_corrected_e2</span></code>
are <code class="docutils literal notranslate"><span class="pre">(0.09934103488922119,</span> <span class="pre">-3.746108423463568e-10)</span></code>, compared with the expected <code class="docutils literal notranslate"><span class="pre">(0.09975,</span>
<span class="pre">0)</span></code> for a perfect PSF correction method.</p>
<p>The code below gives an example of how one could run this routine on a large batch of galaxies,
explicitly catching and tracking any failures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n_image</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n_fail</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_image</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1">#...some code defining this_image, this_final_epsf_image...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">result</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">hsm</span><span class="o">.</span><span class="n">EstimateShear</span><span class="p">(</span><span class="n">this_image</span><span class="p">,</span> <span class="n">this_final_epsf_image</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">error_message</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">n_fail</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="s2">&quot;Number of failures: &quot;</span><span class="p">,</span> <span class="n">n_fail</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gal_image</strong> – The <a class="reference internal" href="image_class.html#galsim.Image" title="galsim.Image"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Image</span></code></a> of the galaxy being measured.</p></li>
<li><p><strong>PSF_image</strong> – The <a class="reference internal" href="image_class.html#galsim.Image" title="galsim.Image"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Image</span></code></a> for the PSF.</p></li>
<li><p><strong>weight</strong> – The optional weight image for the galaxy being measured.  Can be an int
or a float array.  Currently, GalSim does not account for the variation
in non-zero weights, i.e., a weight map is converted to an image with 0
and 1 for pixels that are not and are used.  Full use of spatial
variation in non-zero weights will be included in a future version of
the code.</p></li>
<li><p><strong>badpix</strong> – The optional bad pixel mask for the image being used.  Zero should be
used for pixels that are good, and any nonzero value indicates a bad
pixel.</p></li>
<li><p><strong>sky_var</strong> – The variance of the sky level, used for estimating uncertainty on the
measured shape. [default: 0.]</p></li>
<li><p><strong>shear_est</strong> – A string indicating the desired method of PSF correction: ‘REGAUSS’,
‘LINEAR’, ‘BJ’, or ‘KSB’. The first three options return an e-type
distortion, whereas the last option returns a g-type shear.  [default:
‘REGAUSS’]</p></li>
<li><p><strong>recompute_flux</strong> – A string indicating whether to recompute the object flux, which
should be ‘NONE’ (for no recomputation), ‘SUM’ (for recomputation via
an unweighted sum over unmasked pixels), or ‘FIT’ (for
recomputation using the Gaussian + quartic fit). [default: ‘FIT’]</p></li>
<li><p><strong>guess_sig_gal</strong> – Optional argument with an initial guess for the Gaussian sigma of the
galaxy (in pixels). [default: 5.]</p></li>
<li><p><strong>guess_sig_PSF</strong> – Optional argument with an initial guess for the Gaussian sigma of the
PSF (in pixels). [default: 3.]</p></li>
<li><p><strong>precision</strong> – The convergence criterion for the moments. [default: 1e-6]</p></li>
<li><p><strong>guess_centroid</strong> – An initial guess for the object centroid (useful in
case it is not located at the center, which is used if this keyword is
not set).  The convention for centroids is such that the center of
the lower-left pixel is (image.xmin, image.ymin).
[default: gal_image.true_center]</p></li>
<li><p><strong>strict</strong> – Whether to require success. If <code class="docutils literal notranslate"><span class="pre">strict=True</span></code>, then there will be a
<code class="docutils literal notranslate"><span class="pre">GalSimHSMError</span></code> exception if shear estimation fails.  If set to
<code class="docutils literal notranslate"><span class="pre">False</span></code>, then information about failures will be silently stored in
the output ShapeData object. [default: True]</p></li>
<li><p><strong>hsmparams</strong> – The hsmparams keyword can be used to change the settings used by
<a class="reference internal" href="#galsim.hsm.EstimateShear" title="galsim.hsm.EstimateShear"><code class="xref any py py-func docutils literal notranslate"><span class="pre">EstimateShear</span></code></a> when estimating shears; see <a class="reference internal" href="#galsim.hsm.HSMParams" title="galsim.hsm.HSMParams"><code class="xref any py py-class docutils literal notranslate"><span class="pre">HSMParams</span></code></a> documentation
for more information. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#galsim.hsm.ShapeData" title="galsim.hsm.ShapeData"><code class="xref any py py-class docutils literal notranslate"><span class="pre">ShapeData</span></code></a> object containing the results of shape measurement.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="hsm-output">
<h2>HSM output<a class="headerlink" href="#hsm-output" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="galsim.hsm.ShapeData">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">galsim.hsm.</span></code><code class="sig-name descname"><span class="pre">ShapeData</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_bounds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">galsim.BoundsI()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moments_status</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">observed_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">galsim.Shear(0j)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moments_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moments_amp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moments_centroid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">galsim.PositionD(x=0.0,</span> <span class="pre">y=0.0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moments_rho4</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moments_n_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correction_status</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrected_e1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrected_e2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrected_g1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrected_g2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meas_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'None'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrected_shape_err</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correction_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'None'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resolution_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psf_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psf_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">galsim.Shear(0j)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/hsm.html#ShapeData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#galsim.hsm.ShapeData" title="Permalink to this definition">¶</a></dt>
<dd><p>A class to contain the outputs of the HSM shape and moments measurement routines.</p>
<p>The ShapeData class contains the following information about moment measurement (from either
<a class="reference internal" href="#galsim.hsm.EstimateShear" title="galsim.hsm.EstimateShear"><code class="xref any py py-func docutils literal notranslate"><span class="pre">EstimateShear</span></code></a> or <a class="reference internal" href="#galsim.hsm.FindAdaptiveMom" title="galsim.hsm.FindAdaptiveMom"><code class="xref any py py-func docutils literal notranslate"><span class="pre">FindAdaptiveMom</span></code></a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">image_bounds</span></code>: a <a class="reference internal" href="bounds.html#galsim.BoundsI" title="galsim.BoundsI"><code class="xref any py py-class docutils literal notranslate"><span class="pre">BoundsI</span></code></a> object describing the image.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">moments_status</span></code>: the status flag resulting from moments measurement; -1 indicates no
attempt to measure, 0 indicates success.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">observed_shape</span></code>: a <a class="reference internal" href="shear.html#galsim.Shear" title="galsim.Shear"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shear</span></code></a> object representing the observed shape based on adaptive
moments.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">moments_sigma</span></code>: size <code class="docutils literal notranslate"><span class="pre">sigma=(det</span> <span class="pre">M)^(1/4)</span></code> from the adaptive moments, in units of pixels;
-1 if not measured.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">moments_amp</span></code>: total image intensity for best-fit elliptical Gaussian from adaptive moments.
Normally, this field is simply equal to the image flux (for objects that follow a Gaussian
light distribution, otherwise it is something approximating the flux).  However, if the image
was drawn using <code class="docutils literal notranslate"><span class="pre">drawImage(method='sb')</span></code> then moments_amp relates to the flux via
<code class="docutils literal notranslate"><span class="pre">flux=(moments_amp)*(pixel</span> <span class="pre">scale)^2</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">moments_centroid</span></code>: a <a class="reference internal" href="pos.html#galsim.PositionD" title="galsim.PositionD"><code class="xref any py py-class docutils literal notranslate"><span class="pre">PositionD</span></code></a> object representing the centroid based on adaptive
moments, in units of pixels.  The indexing convention is defined with respect to the <a class="reference internal" href="bounds.html#galsim.BoundsI" title="galsim.BoundsI"><code class="xref any py py-class docutils literal notranslate"><span class="pre">BoundsI</span></code></a>
object defining the bounds of the input <a class="reference internal" href="image_class.html#galsim.Image" title="galsim.Image"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Image</span></code></a>, i.e., the center of the lower left pixel is
<code class="docutils literal notranslate"><span class="pre">(image.xmin,</span> <span class="pre">image.ymin)</span></code>.  An object drawn at the center of the image should generally
have moments_centroid equal to <code class="docutils literal notranslate"><span class="pre">image.true_center</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">moments_rho4</span></code>: the weighted radial fourth moment of the image.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">moments_n_iter</span></code>: number of iterations needed to get adaptive moments, or 0 if not measured.</p></li>
</ul>
<p>If <a class="reference internal" href="#galsim.hsm.EstimateShear" title="galsim.hsm.EstimateShear"><code class="xref any py py-func docutils literal notranslate"><span class="pre">EstimateShear</span></code></a> was used, then the following fields related to PSF-corrected shape will also
be populated:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">correction_status</span></code>: the status flag resulting from PSF correction; -1 indicates no attempt
to measure, 0 indicates success.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">corrected_e1</span></code>, <code class="docutils literal notranslate"><span class="pre">corrected_e2</span></code>, <code class="docutils literal notranslate"><span class="pre">corrected_g1</span></code>, <code class="docutils literal notranslate"><span class="pre">corrected_g2</span></code>: floats representing
the estimated shear after removing the effects of the PSF.  Either e1/e2 or g1/g2 will differ
from the default values of -10, with the choice of shape to use determined by the correction
method (since the correction method determines what quantity is estimated, either the shear or
the distortion).  After a measurement is made, the type of shape measurement is stored in the
ShapeData structure as ‘meas_type’ (a string that equals either ‘e’ or ‘g’).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">corrected_shape_err</span></code>: shape measurement uncertainty sigma_gamma per component.  The
estimate of the uncertainty will only be non-zero if an estimate of the sky variance was
passed to <a class="reference internal" href="#galsim.hsm.EstimateShear" title="galsim.hsm.EstimateShear"><code class="xref any py py-func docutils literal notranslate"><span class="pre">EstimateShear</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">correction_method</span></code>: a string indicating the method of PSF correction (will be “None” if
PSF-correction was not carried out).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resolution_factor</span></code>: Resolution factor R_2;  0 indicates object is consistent with a PSF, 1
indicates perfect resolution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">psf_sigma</span></code>: size <code class="docutils literal notranslate"><span class="pre">sigma=(det</span> <span class="pre">M)^(1/4)</span></code> of the PSF from the adaptive moments, in units of
pixels; -1 if not measured.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">psf_shape</span></code>: a <a class="reference internal" href="shear.html#galsim.Shear" title="galsim.Shear"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shear</span></code></a> object representing the observed PSF shape based on adaptive moments.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_message</span></code>: a string containing any error messages from the attempt to carry out
PSF-correction.</p></li>
</ul>
<p>The <a class="reference internal" href="#galsim.hsm.ShapeData" title="galsim.hsm.ShapeData"><code class="xref any py py-class docutils literal notranslate"><span class="pre">ShapeData</span></code></a> object can be initialized completely empty, or can be returned from the
routines that measure object moments (<a class="reference internal" href="#galsim.hsm.FindAdaptiveMom" title="galsim.hsm.FindAdaptiveMom"><code class="xref any py py-func docutils literal notranslate"><span class="pre">FindAdaptiveMom</span></code></a>) and carry out PSF correction
(<a class="reference internal" href="#galsim.hsm.EstimateShear" title="galsim.hsm.EstimateShear"><code class="xref any py py-func docutils literal notranslate"><span class="pre">EstimateShear</span></code></a>).</p>
</dd></dl>

</div>
<div class="section" id="hsm-parameters">
<h2>HSM parameters<a class="headerlink" href="#hsm-parameters" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="galsim.hsm.HSMParams">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">galsim.hsm.</span></code><code class="sig-name descname"><span class="pre">HSMParams</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nsig_rg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nsig_rg2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_moment_nsig2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">25.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regauss_too_small</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adapt_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convergence_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_mom2_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_iter_default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bound_correct_wt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_amoment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_ashift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ksb_moments_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ksb_sig_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ksb_sig_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">failed_moments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1000.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/hsm.html#HSMParams"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#galsim.hsm.HSMParams" title="Permalink to this definition">¶</a></dt>
<dd><p>A collection of parameters that govern how the HSM functions operate.</p>
<p>HSMParams stores a set of numbers that determine how the moments/shape estimation
routines make speed/accuracy tradeoff decisions and/or store their results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nsig_rg</strong> – A parameter used to optimize convolutions by cutting off the galaxy
profile.  In the first step of the re-Gaussianization method of PSF
correction, a Gaussian approximation to the pre-seeing galaxy is
calculated. If <code class="docutils literal notranslate"><span class="pre">nsig_rg</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>, then this approximation is cut off
at <code class="docutils literal notranslate"><span class="pre">nsig_rg</span></code> sigma to save computation time in convolutions.
[default: 3.0]</p></li>
<li><p><strong>nsig_rg2</strong> – A parameter used to optimize convolutions by cutting off the PSF
residual profile.  In the re-Gaussianization method of PSF
correction, a ‘PSF residual’ (the difference between the true PSF
and its best-fit Gaussian approximation) is constructed. If
<code class="docutils literal notranslate"><span class="pre">nsig_rg2</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>, then this PSF residual is cut off at <code class="docutils literal notranslate"><span class="pre">nsig_rg2</span></code>
sigma to save computation time in convolutions. [default: 3.6]</p></li>
<li><p><strong>max_moment_nsig2</strong> – A parameter for optimizing calculations of adaptive moments by
cutting off profiles. This parameter is used to decide how many
sigma^2 into the Gaussian adaptive moment to extend the moment
calculation, with the weight being defined as 0 beyond this point.
i.e., if max_moment_nsig2 is set to 25, then the Gaussian is
extended to <code class="docutils literal notranslate"><span class="pre">(r^2/sigma^2)=25</span></code>, with proper accounting for
elliptical geometry.  If this parameter is set to some very large
number, then the weight is never set to zero and the exponential
function is always called. Note: GalSim script
devel/modules/test_mom_timing.py was used to choose a value of 25 as
being optimal, in that for the cases that were tested, the speedups
were typically factors of several, but the results of moments and
shear estimation were changed by &lt;10^-5.  Not all possible cases
were checked, and so for use of this code for unusual cases, we
recommend that users check that this value does not affect accuracy,
and/or set it to some large value to completely disable this
optimization. [default: 25.0]</p></li>
<li><p><strong>regauss_too_small</strong> – A parameter for how strictly the re-Gaussianization code treats
small galaxies. If this parameter is 1, then the re-Gaussianization
code does not impose a cut on the apparent resolution before trying
to measure the PSF-corrected shape of the galaxy; if 0, then it is
stricter.  Using the default value of 1 prevents the
re-Gaussianization PSF correction from completely failing at the
beginning, before trying to do PSF correction, due to the crudest
possible PSF correction (Gaussian approximation) suggesting that
the galaxy is very small.  This could happen for some usable
galaxies particularly when they have very non-Gaussian surface
brightness profiles – for example, if there’s a prominent bulge
that the adaptive moments attempt to fit, ignoring a more
extended disk.  Setting a value of 1 is useful for keeping galaxies
that would have failed for that reason.  If they later turn out to
be too small to really use, this will be reflected in the final
estimate of the resolution factor, and they can be rejected after
the fact. [default: 1]</p></li>
<li><p><strong>adapt_order</strong> – The order to which circular adaptive moments should be calculated
for KSB method. This parameter only affects calculations using the
KSB method of PSF correction.  Warning: deviating from default
value of 2 results in code running more slowly, and results have
not been significantly tested. [default: 2]</p></li>
<li><p><strong>convergence_threshold</strong> – Accuracy (in x0, y0, and sigma, each as a fraction of sigma)
when calculating adaptive moments. [default: 1.e-6]</p></li>
<li><p><strong>max_mom2_iter</strong> – Maximum number of iterations to use when calculating adaptive
moments.  This should be sufficient in nearly all situations, with
the possible exception being very flattened profiles. [default: 400]</p></li>
<li><p><strong>num_iter_default</strong> – Number of iterations to report in the output ShapeData structure
when code fails to converge within max_mom2_iter iterations.
[default: -1]</p></li>
<li><p><strong>bound_correct_wt</strong> – Maximum shift in centroids and sigma between iterations for
adaptive moments. [default: 0.25]</p></li>
<li><p><strong>max_amoment</strong> – Maximum value for adaptive second moments before throwing
exception.  Very large objects might require this value to be
increased. [default: 8000]</p></li>
<li><p><strong>max_ashift</strong> – Maximum allowed x / y centroid shift (units: pixels) between
successive iterations for adaptive moments before throwing
exception. [default: 15]</p></li>
<li><p><strong>ksb_moments_max</strong> – Use moments up to ksb_moments_max order for KSB method of PSF
correction. [default: 4]</p></li>
<li><p><strong>ksb_sig_weight</strong> – The width of the weight function (in pixels) to use for the KSB
method.  Normally, this is derived from the measured moments of the
galaxy image; this keyword overrides this calculation.  Can be
combined with ksb_sig_factor. [default: 0.0]</p></li>
<li><p><strong>ksb_sig_factor</strong> – Factor by which to multiply the weight function width for the KSB
method (default: 1.0).  Can be combined with ksb_sig_weight.
[default: 1.0]</p></li>
<li><p><strong>failed_moments</strong> – Value to report for ellipticities and resolution factor if shape
measurement fails. [default: -1000.]</p></li>
</ul>
</dd>
</dl>
<p>After construction, all of the above are available as read-only attributes.</p>
<dl class="py method">
<dt id="galsim.hsm.HSMParams.check">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">check</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hsmparams</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/hsm.html#HSMParams.check"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#galsim.hsm.HSMParams.check" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks that hsmparams is either a valid HSMParams instance or None.</p>
<p>In the former case, it returns hsmparams, in the latter it returns default
(HSMParams.default if no other default specified).</p>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="config_process.html" class="btn btn-neutral float-left" title="Config Processing From Python" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="des.html" class="btn btn-neutral float-right" title="The DES Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, GalSim-developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>